make transparent

further divide code into functions as much as possible